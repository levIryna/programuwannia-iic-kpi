{% extends "computer_vision/base_dashboard.html" %}

{% block content %}
<div class="recognition-container">
    <h2 class="section-title">üìä –ú–æ–¥—É–ª—å —Å–ø–µ–∫—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É</h2>
    <p class="sub-title">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∞—É–¥—ñ–æ—Ñ–∞–π–ª –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –π–æ–≥–æ —á–∞—Å—Ç–æ—Ç–Ω–æ–≥–æ —Å–ø–µ–∫—Ç—Ä—É —Ç–∞ —á–∞—Å–æ–≤–æ—ó —Ñ–æ—Ä–º–∏.</p>

    <div class="upload-section">
        <form id="upload-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
    
        <div class="input-group">
             {{ form.audio }}
        </div>

    <button type="submit" id="submit-btn" class="btn-primary">
        –ü–æ–±—É–¥—É–≤–∞—Ç–∏ —Å–ø–µ–∫—Ç—Ä–æ–≥—Ä–∞–º—É
    </button>
        </form>
    </div>

    <div id="status-area" class="status-area">
        <div id="loader" class="loader-container" style="display: none;">
            <div class="spinner"></div>
            <p>–í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –æ–±—Ä–æ–±–∫–∞ —Å–∏–≥–Ω–∞–ª—É —Ç–∞ –ø–æ–±—É–¥–æ–≤–∞ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤...</p>
        </div>

        {% if result %}
        <div class="result-box animated fadeIn">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑—É:</h3>
            
            <div class="audio-preview" style="margin-bottom: 20px;">
                <audio controls style="width: 100%; max-width: 500px;">
                    <source src="{{ instance.audio.url }}" type="audio/mpeg">
                </audio>
            </div>

            <div class="spectral-plots">
                <div class="plot-item" style="margin-top: 20px;">
                    <h4>–ß–∞—Å—Ç–æ—Ç–Ω–∏–π —Å–ø–µ–∫—Ç—Ä (Spectrogram):</h4>
                    <img src="data:image/png;base64,{{ spectrogram_img }}" alt="–°–ø–µ–∫—Ç—Ä–æ–≥—Ä–∞–º–∞" 
                         style="width: 100%; max-width: 800px; border-radius: 8px; border: 1px solid #ddd;">
                </div>
            </div>
            
            <p class="result-text" style="margin-top: 15px;">{{ result }}</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
    const form = document.getElementById('upload-form');
    const loader = document.getElementById('loader');
    const statusArea = document.querySelector('.result-box');

    form.onsubmit = function() {
        if (statusArea) {
            statusArea.style.display = 'none';
        }
        loader.style.display = 'block';
        document.getElementById('submit-btn').disabled = true;
    };
</script>
{% endblock %}