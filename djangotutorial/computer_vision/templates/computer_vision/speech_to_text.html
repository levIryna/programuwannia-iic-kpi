{% extends "computer_vision/base_dashboard.html" %}

{% block content %}
<div class="recognition-container">
    <h2 class="section-title">üéôÔ∏è –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –º–æ–≤–ª–µ–Ω–Ω—è (Speech-to-Text)</h2>
    <p class="sub-title">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∞—É–¥—ñ–æ—Ñ–∞–π–ª (MP3 –∞–±–æ WAV), —â–æ–± –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –≥–æ–ª–æ—Å —É –¥—Ä—É–∫–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç.</p>

    <div class="upload-section">
        <form id="upload-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="input-group">
                {{ form.audio }}
            </div>

            <button type="submit" id="submit-btn" class="btn-primary">
                –†–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ —Ç–µ–∫—Å—Ç
            </button>
        </form>
    </div>

    <div id="status-area" class="status-area">
        <div id="loader" class="loader-container" style="display: none;">
            <div class="spinner"></div>
            <p>–®—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç —Å–ª—É—Ö–∞—î —Ç–∞ —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î –∞—É–¥—ñ–æ...</p>
        </div>

        {% if result %}
        <div class="result-box animated fadeIn">
            <h3>–†–æ–∑—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç:</h3>
            
            <div class="audio-preview" style="margin-top: 10px; margin-bottom: 20px;">
                <audio controls style="width: 100%;">
                    <source src="{{ instance.audio.url }}" type="audio/mpeg">
                </audio>
            </div>

            <div class="text-output" style="background: #f9f9f9; padding: 20px; border-left: 5px solid #6c5ce7; border-radius: 5px; font-style: italic; color: #2d3436; font-size: 1.1rem;">
                "{{ result }}"
            </div>
            
            <p class="sub-text" style="margin-top: 15px; font-size: 0.9rem; color: #636e72;">
                –ú–æ–≤–∞: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ | –ú–æ–¥–µ–ª—å: Google Speech API
            </p>
        </div>
        {% endif %}
    </div>
</div>

<script>
    const form = document.getElementById('upload-form');
    const loader = document.getElementById('loader');
    const statusArea = document.querySelector('.result-box');

    form.onsubmit = function() {
        if (statusArea) {
            statusArea.style.display = 'none';
        }
        loader.style.display = 'block';
        document.getElementById('submit-btn').disabled = true;
    };
</script>
{% endblock %}